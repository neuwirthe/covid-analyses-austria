---
title: "get vac data"
author: "Erich Neuwirth"
date: '2022-02-28'
output: html_document
---


```{r setup, echo=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
) 
```

```{r}
temp_path <-
  path(here(),"data","temp_data")
```

```{r}
suppressPackageStartupMessages({
  library(here)
  library(fs)
})  
source(path(here(),"utils","purl_and_source.R"))
purl_and_source(path(here(),"utils","base_utils.Rmd"))
```

```{r}
purl_and_source(path(here(),"utils","get_data_utils.Rmd"))
```

```{r}
save_path <- path(here(),"data","raw_data")
```

```{r}
curl::curl_download(
  "https://covid19-dashboard.ages.at/data/data.zip",
  destfile=path(temp_path,
                 "data.zip"))

```


```{r}
unzip(path(temp_path,"data.zip"),
      overwrite=TRUE,
      exdir=temp_path)
```

```{r}
char_to_date <- function(s){
  strptime(s,format="%d.%m.%Y") |>
    as.Date()
}
```

```{r}
read_carefully(path(temp_path,"CovidFaelleDelta.csv")) |>
  mutate(Datum=char_to_date(Datum) + 1) |>
  rename(cases_AGES_daily=DeltaAnzahlVortag) |>
  rename(Genesen_AGES_daily=DeltaGeheiltVortag) |>
  rename(Tot_AGES_daily=DeltaTotVortag) |>
  rename(Aktiv_AGES_daily=DeltaAktivVortag) |>
  rename(Tests_alle_AGES_daily=DeltaTestGesamtVortag) ->
  ages_daily_data
```

```{r}
save(ages_daily_data,
     file=path(save_path,"ages_daily_data.RData"))
```


```{r}
read_carefully(path(temp_path,
                    "CovidFaelle_Altersgruppe.csv")) |>
    mutate(Datum=char_to_date(Time) + 1, .before=1) |>
  select(-Time) |> 
  rename(pop=AnzEinwohner) |>
  mutate(Geschlecht=tolower(Geschlecht)) |>
  rename(cases_AGES=Anzahl) |>
  rename(Genesen_AGES=AnzahlGeheilt) |>
  rename(Tot_AGES=AnzahlTot) |>
  rename(Alter=Altersgruppe) |>
  mutate(Alter=ifelse(Alter=="<5","0-5",Alter)) |>
  mutate(Alter=ifelse(Alter==">84","85-",Alter)) |>
  select(Datum,BundeslandID,Bundesland,AltersgruppeID,
         Alter,Geschlecht,
         pop,everything()) ->
  ages_age_data 
```


```{r}
save(ages_age_data,
     file=path(save_path,"ages_age_data.RData"))
```


```{r}
read_carefully(path(temp_path,
                    "CovidFaelle_GKZ.csv")) |>
  
```


```{r}
read_carefully(path(temp_path,
                    "CovidFaelle_Timeline_GKZ.csv")) 
  
```



```{r}
read_carefully(path(temp_path,
                    "CovidFaelle_Timeline.csv")) 
  
```


```{r}
read_carefully(path(temp_path,
                    "CovidFallzahlen.csv")) 
  
```



```{r}
read_carefully(path(temp_path,
                    "Hospitalisierung.csv")) 
  
```